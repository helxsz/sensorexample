<style>
.board {
padding-bottom: 30px;
padding-top: 30px;
padding-left:40px;
background: rgb(219, 224, 213);
margin-bottom: 40px;
}
.board-description{
margin-left: auto;
margin-right: auto;
 width: 460px;;
}
.board-title{
color:rgb(85, 131, 143);
}

.form_container{
margin-left: auto;
margin-right: auto;
width: 1000px;
margin-top: 20px;
}




.form-action input[type="submit"], modal-btn {
display: block;
height: 33px;
line-height: 34px;
padding: 0 15px;
background-color: #55bc75;
color: #fff;
cursor: pointer;
border: none;
-webkit-border-radius: 2px;
-moz-border-radius: 2px;
border-radius: 2px;
-webkit-transition: opacity 0.2s linear;
-moz-transition: opacity 0.2s linear;
transition: opacity 0.2s linear;
-webkit-border-radius: 40px;
border-radius: 40px;
margin-top:5px;
margin-top:5px;
}
.form-action input[type="submit"]:hover, , modal-btn:hover{
background-color: #409f89;
}
</style>

<style>
ul {
	list-style: none;
	margin: 0;
	padding: 0;
}

a { text-decoration: none; }

.status-progress {
	background: #ccc;
	border-radius: 3px;
	height: 6px;
	margin: 9px 0;
	position: relative;
	width: 100%;
}

.status-progress ul {
	position: absolute;
	top: -11px;
}

.status-progress li {
	float: left;
	margin: 0 72px;
}

.status-progress li:first-child { margin-left: 0; }
.status-progress li:last-child { margin-right: 0; }

.status-progress a {
	background: #439ec4;
	border-radius: 100%;
	border: 2px solid #eee;
	color: #fff;
	display: inline-block;
	height: 24px;
	line-height: 24px;
	position: relative;
	text-align: center;
	width: 24px;
}

.status-progress .current { background: #43c47a; }

.status-progress .progress-info {
	background: #1f222c;
	border-radius: 3px;
	color: #ccc;
	display: block;
	font-size: 12px;
	height: 32px;
	left: -68px;
	line-height: 32px;
	position: absolute;
	top: -48px;
	width: 160px;
}

.status-progress .progress-info:after {
	background: #1f222c;
	content: '';
	display: block;
	height: 8px;
	left: 76px;
	position: absolute;
	top: 28px;
	-webkit-transform: rotate(45deg);
	-moz-transform: rotate(45deg);
	-ms-transform: rotate(45deg);
	-o-transform: rotate(45deg);
	transform: rotate(45deg);
	width: 8px;
}

</style>


<style>


.user-info {
	height: 48px;
	padding: 10px;
}

.user-info p {
	font-size: 16px;
	font-weight: bold;
	margin: 6px 0 0 60px;
}

.user-info span {
	color: #555555;
	font-size: 11px;
	margin-left: 10px;
	padding-left: 8px;
	background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAKCAYAAACXDi8zAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4NUEzMTJCRTBCMjA2ODExOEMxNEI3NzJFOUU0MzIyOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCM0JENjY0Njk0OUYxMUUyOTREMkM4NTFFQUJFMDMwOCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCM0JENjY0NTk0OUYxMUUyOTREMkM4NTFFQUJFMDMwOCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBMzM4RjE4QTMxOTNFMjExQTI3NUQ4QzI0OTk2NDI0MSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4NUEzMTJCRTBCMjA2ODExOEMxNEI3NzJFOUU0MzIyOSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhRzYYcAAACpSURBVHjadI8tEoMwEIXfZmo4CKhMFL4mHAEuwD1io2g0AlXHETrDBdCYcgJ0Ut1ttqJT0a55+/u+WWJm/IpTSo88YYQQsG0btNZwzpGS5jBcUFUVpmlCWZbouu6mntlq3++w1oKI0DSNOJ2VykVRFFiWBcITzXFQjJHHccS6rt/sK6WUWDb7vv9053kWOISPuq7fqTFG4IBYyZWo955T1rZtQf8efAkwACtRUK7OBfX9AAAAAElFTkSuQmCC) no-repeat 0 center;
}

.user-info img {
	float: left;
	border-radius:3px;
	height:50px;
	weight:50px;
}

</style>


<style>
.tasks-lists {
  position: absolute;
  top: 50%;
  right: 10px;
  margin-top: -11px;
  padding: 10px 4px;
  width: 19px;
  height: 3px;
  font: 0/0 serif;
  text-shadow: none;
  color: transparent;
}
.tasks-lists:before {
  content: '';
  display: block;
  height: 3px;
  background: #8c959d;
  border-radius: 1px;
  -webkit-box-shadow: 0 6px #8c959d, 0 -6px #8c959d;
  box-shadow: 0 6px #8c959d, 0 -6px #8c959d;
}

.tasks-list-item {
  display: block;
  line-height: 24px;
  padding: 12px 15px;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.tasks-list-item + .tasks-list-item {
  border-top: 1px solid #f0f2f3;
}

.tasks-list-cb {
  display: none;
}

.tasks-list-mark {
  position: relative;
  display: inline-block;
  vertical-align: top;
  margin-right: 12px;
  width: 20px;
  height: 20px;
  border: 2px solid #c4cbd2;
  border-radius: 12px;
}
.tasks-list-mark:before {
  content: '';
  display: none;
  position: absolute;
  top: 50%;
  left: 50%;
  margin: -5px 0 0 -6px;
  height: 4px;
  width: 8px;
  border: solid #39ca74;
  border-width: 0 0 4px 4px;
  -webkit-transform: rotate(-45deg);
  -moz-transform: rotate(-45deg);
  -ms-transform: rotate(-45deg);
  -o-transform: rotate(-45deg);
  transform: rotate(-45deg);
}
.tasks-list-cb:checked ~ .tasks-list-mark {
  border-color: #39ca74;
}
.tasks-list-cb:checked ~ .tasks-list-mark:before {
  display: block;
}

.tasks-list-desc {
  font-weight: bold;
  color: #8a9a9b;
}
.tasks-list-cb:checked ~ .tasks-list-desc {
  color: #34bf6e;
  //text-decoration: line-through;
}


</style>

    <span id="loading" class="folding">Loading...</span>

<div class="row-fluid">
 
    <div class="form_container row">
      <div class="span8" style="border-right: 1px dotted #d0d5cb;">
			<div class="status-progress">				
				<ul >
				</ul>
			</div> <!-- end status-progress -->
			
	 		

	  
        <a data-toggle="modal" class="modal-btn" style="display:none;" href="#PlanModal">Add Plan</a>
		
<div class="modal hide" id="PlanModal">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h3>Add Plan</h3>
    </div>
        <div class="modal-body" style="text-align:left;">
        <div class="row-fluid">
            <div class="span10 offset1">
                <div id="modalTab">
                    <div class="tab-content row">
					
		<div class="tdl-holder span8">
			<h2>GOAL LIST</h2>
			<div class="tdl-content">
				<ul>
					<!-- <li><label><i></i><span class="tdl-goal">get up</span><a class="tdl-del" href='#'>x</a></label></li> -->
				</ul>
			</div>
			<input type="text" class="tdl-new" placeholder="Write new item and hit 'Enter'...">
		</div>										
                        <div class="tab-pane active span4" >
                            <form method="post" action='' id="add_plan_form">
                                <!-- <p><input type="text" class="span12" name="milestones" id="milestones" placeholder="Milestones"></p> -->
                                <p><button type="submit" class="btn btn-primary">Add Milestone and Plan</button></p>                                
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>		

<style>
.tdl-holder{
	margin:0px auto;
	width: 300px;
}

.tdl-holder h2{
	background-color: #de3f53;
	border-top-left-radius: 4px;
	border-top-right-radius: 4px;
	color:#fff;
	font-family:"Roboto Condensed", Arial, sans-serif;
	font-size:16px;
	font-weight: 100;
	padding-left: 15px;
	margin:0;
}

.tdl-holder ul, .tdl-holder li {
	list-style: none;
	margin:0;
	padding:0;
}

.tdl-holder li{
	background-color: #262e4c;
	border-bottom:1px solid #1c2340;
	color: #b1b2c9;
}

.tdl-holder li span{
	margin-left:30px;
	-webkit-transition: all .2s linear;
	   -moz-transition: all .2s linear;
	     -o-transition: all .2s linear;
		    transition: all .2s linear;	
}

.tdl-holder label{
	cursor:pointer;
	display:block;
	line-height: 22px;
	padding: 0 15px; 
	position: relative;
}

.tdl-holder label:hover{
	background-color: #2a3353;
	color:#8284a3;
}

.tdl-holder label a{
	background-color:#de3f53;
	border-radius:50%;
	color:#fff;
	display:none;
	float:right;
	font-weight: bold;
	line-height: normal;
	height:16px;
	margin-top: 5px;
	text-align: center;
	text-decoration: none;
	width:16px;
	-webkit-transition: all .2s linear;
	   -moz-transition: all .2s linear;
	     -o-transition: all .2s linear;
		    transition: all .2s linear;	
}

.tdl-holder label:hover a{
	display: block;
}

.tdl-holder label a:hover{	
	background-color:#fff;
	color:#de3f53;
}
.tdl-holder li.remove{
	-webkit-animation:collapseItem 300ms ease;
			animation:collapseItem 300ms ease;
	-webkit-transform-origin: 50% 0%;
		-ms-transform-origin: 50% 0%;
			transform-origin: 50% 0%;

}

.tdl-holder li.remove span{
	color: #586186;
	text-decoration: line-through;
}

@keyframes collapseItem {
    0% 		{ -ms-transform: perspective(500px) rotateX(0deg);transform: perspective(500px) rotateX(0deg); 	}
    100% 	{ -ms-transform: perspective(500px) rotateX(-90deg);transform: perspective(500px) rotateX(-90deg); }
}

@-webkit-keyframes collapseItem {
    0% 		{ -webkit-transform: perspective(500px) rotateX(0deg); 	}
    100% 	{ -webkit-transform: perspective(500px) rotateX(-90deg);}
}

.tdl-holder input[type="text"]{
	background-color: #171d37;
	border: none;
	border-bottom-left-radius: 4px;
	border-bottom-right-radius: 4px;
	box-shadow: inset 0 0 8px 0 #0e1329;
	color: #464f72;
	font-size:14px;
	margin:0;
	padding:10px 15px;
	width:270px;
	-webkit-transition: all .2s linear;
	   -moz-transition: all .2s linear;
	     -o-transition: all .2s linear;
		    transition: all .2s linear;		
}

.tdl-holder input[type="text"]:hover{
	color:#4c577f;
}

.tdl-holder input[type="text"]:focus{
	color:#fff;
}
</style>
<script>
    $('.tdl-new').bind('keypress', function(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if(code == 13) { //Enter keycode
			console.log( $('.tdl-new').val() );
			var a = $( '<li><label><i></i><span class="tdl-goal">'+ $('.tdl-new').val() +'</span><a class="tdl-del" href="#">x</a></label></li>');
			a.appendTo($('.tdl-content ul'));
			a.find('.tdl-del').click(function(e){
			    $(this).parent().parent().remove();
			})
            $('.tdl-new').val('');
			
        }		
	});
	
$("#add_plan_form").on('submit',function(e){
    console.log('click add_plan_form');		
    e.preventDefault();

	var serialData = "";
	$('.tdl-content ul li').each(function(e){
		console.log( $(this).find('span').text(), $(this).html() );
		serialData+=$(this).find('span').text();
		serialData+=",";
	})	
	serialData = serialData.substring(0,serialData.length-1);
	console.log(serialData.split(',').length);
	serialData = 'goals='+serialData;
	console.log(serialData);
    $.ajax({
           type: "POST",
           url: "/course/"+course_id+"/tutor/plan",
           data: serialData, 
           success: function(data)
           {
                console.log(data);		   
           }
    }); 	
});	
</script>	
		</div>
		
		
		<div class="span4"   >

		<style>
#addMilestoneForm input[type='text'] {
  width: 200px;
height: 40px;
  border: none;
  background-color: transparent;
  font-size: 20px;
  font-weight:300;
  color: white;
  float:left;
  -webkit-transition: all .3s ease;
  -o-transition: all .3s ease;
  transition: all .3s ease;
  background-color: rgba(0,0,0,.15);

  
  border:1px solid #e5e5e5;

  box-shadow:0px 1px 0px #fff;  
}
#addMilestoneForm input[type='submit']{
  height:50px;
  width:70px;
  padding:10px;
  text-align:center;
  background-color: rgba(0,0,0,.25);
  border:0;
  border-left:0;
  color: white;
  cursor:pointer;
  padding:0;
  vertical-align:bottom;
  font:300 18px "Lato", "Arial", sans-serif;
}	

#addMilestoneForm input[type="text"]:focus{
  border:1px solid #539fb5;
}	
</style>
		
        <form method="post" id="addMilestoneForm" action="/workplan/5218b3cbd830bb640c000002/addMilestone/" enctype="multipart/form-data" >
		    <input type="hidden" name="_csrf" value="<%= token %>"/>
            <input type="text" id="milestone_input" placeholder="Add Milestone" name="goal" id="goal">
            <input type="submit" value="Add">
        </form>		
					
        <div class="tasks-list">
	        <!--
            <label class="tasks-list-item">
                <input type="checkbox" name="task_1" value="1" class="tasks-list-cb" checked>
                <span class="tasks-list-mark"></span>
                <span class="tasks-list-desc">print "Hello, World!"</span>
            </label>
	        -->
        </div>

        <form method="post" id="addQuestionForm" class="form-horizontal " enctype="multipart/form-data" >
            <input type="hidden" name="_csrf" value="<%= token %>"/>
			<input type="hidden" name="questions" value="" id="question_input"/>
            <div class="form-action">
                <input type="hidden" id="milestoneInput" type="submit" value="Add Question To Plan"></input>

				<div class="btn-group dropup">
                    <button class="btn">Choose a milestone</button>
                    <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                    </ul>
                </div>
				
            </div>			
        </form>		
			
		</div>
	</div>

</div>


<style>

.tt-hint {
width: 396px;
height: 30px;
padding: 8px 12px;
font-size: 24px;
line-height: 30px;
border: 2px solid #ccc;
-webkit-border-radius: 8px;
-moz-border-radius: 8px;
border-radius: 8px;
outline: none;
}

.tt-dropdown-menu {
width: 422px;
margin-top: 12px;
padding: 8px 0;
background-color: #fff;
border: 1px solid #ccc;
border: 1px solid rgba(0, 0, 0, 0.2);
-webkit-border-radius: 8px;
-moz-border-radius: 8px;
border-radius: 8px;
-webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
-moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);
box-shadow: 0 5px 10px rgba(0,0,0,.2);
}
</style>

<script>

var pathname = window.location.pathname;
console.log(pathname, pathname.split('/')[2]);

var course_id = pathname.split('/')[2];
var plan_id = null;
console.log('course id',course_id);

getTutorPlanInCourse(course_id);
getQuestionOfCourse(course_id);




$('#loading')
    .hide()  // hide it initially
    .ajaxStart(function() {
        $(this).show();
    })
    .ajaxStop(function() {
        $(this).hide();
    })
;


$(document).on('click', '.dropdown-menu li', function () {
    console.log("Selected Option:"+$(this).text(), $(this).attr('data-id'));
	$('#milestoneInput').val($(this).text());
});


$("#addMilestoneForm").on('submit',function(e){
    console.log('click addMilestoneForm');		
    e.preventDefault();
    $.ajax({
           type: "POST",
		   url:"/course/"+ course_id +"/milestone/tutor",
           //url: "/workplan/"+ plan_id +"/addMilestone",
           data: $(this).serialize(), 
           success: function(data)
           {
		        console.log("add milestone   ",data);
		        var len =$('.status-progress ul li').size()
				var s = $('<li><a href="#" title="' + $('#goal').text() +  '" >'+(len+1) +'</a></li>');     // <span class="progress-info">Upload profile picture!</span>
				s.appendTo( $('.status-progress ul') );
			    var wid = $('.status-progress').width()/ (len+1);
			    console.log('wid', $('.status-progress ul').width(), wid);
			    $('.status-progress li').css( "margin-right", wid/3+"px"  );
			    s.tooltip();
                s.popover({ title: 'abc', content: "abcw", html:true, placement:'bottom' });	
                $('#milestone_input').text('');

			   
           }
    });	
});


$("#addQuestionForm").on('submit',function(e){
    console.log('click addQuestionForm');		
    e.preventDefault();
	var array = [];	
	$('.tasks-list input').each(function() {
         var n = $(this).val(); // <- This works
		 if($(this).is(':checked')){
            console.log('check',$(this).parent().attr('data-id'),n);
			array.push( $(this).parent().attr('data-id')  );
		 }
		 else
		 console.log(' not check',n);
    });
	var val = "";
	for(var i=0;i<array.length-1;i++){
	     val+=array[i]+",";	    
	}
	val+=array[array.length-1];
	console.log(val);	
	$('#question_input').val(val);	
	var milestone = $('#milestoneInput').val();	
    $.ajax({
           type: "POST",
		   url:"/course/"+  course_id +"/milestone/"+  milestone +"/addQuestions",
           //url: "/workplan/"+  plan_id  +"/milestone/"+milestone+"/addQuestions",
           data: $(this).serialize(), 
           success: function(data)
           {
	            $('.tasks-list input').each(function() {
                    var n = $(this).val(); 
		            if($(this).is(':checked')){
						$(this).parent().fadeOut(function() {
                            $(this).remove();
                        });
		            }		 
                });				
           }
    });  	
});


function getQuestionOfCourse(course_id){
    $.ajax({
           type: "GET",
           url: "/course/"+ course_id +"/questions", 
		   contentType:"application/json; charset=utf-8",
           dataType:"json",
           success: function(data){
               console.log(data.length,data);
			   data.forEach(function(entry) {
                    console.log(entry.que,entry.sol,entry._id);				    
					$(".tasks-list").append(
					        '<label class="tasks-list-item" data-id="'+entry._id+'">'
                                +'<input type="checkbox" name="task_1" value="0" class="tasks-list-cb" >'
                                +'<span class="tasks-list-mark"></span>'
                                +'<span class="tasks-list-desc">'+entry.que+'</span>'
                            +'</label>'					
					);				   
               });
           }
    });
}


function getTutorPlanInCourse(course_id){
    // get the plan of a student   520db60a8932d7700f000001
    // /course/:course_id/plan/:student_id
    $.ajax({
           type: "GET",
		   url:"/course/"+ course_id +"/tutor/plan",
		   contentType:"application/json; charset=utf-8",
           dataType:"json",		   
           success: function(data)
           {
               console.log('tutor plan :',data,data.plan.length);
			   if(!data ){
			        $('.modal-btn').show();
			        $('.status-progress').hide();
					return;
			   }
			   
			   plan_id = data._id;
			   console.log('plan id',plan_id);
			   for(var i=0;i<data.plan.length;i++){
			        console.log('goal',data.plan[i].goal);
					var s = $('<li data-id="'+data._id+'" data-index="'+  i +'" ><a href="#" title="' + data.plan[i].goal +  '" data-toggle="' + data.plan[i].goal +  '"      >'+(i+1) +'</a></li>');     // <span class="progress-info">Upload profile picture!</span>
					if(data.plan[i].goal){ 
					    if(data.plan[i].ques){
					        for(var j=0;j<data.plan[i].ques.length;j++){
					            console.log('.....'+data.plan[i].ques[j]);
					        }
						}
					    s.appendTo( $('.status-progress ul') );
					    s.popover({ title: data.plan[i].goal, content: "", html:true, placement:'bottom' });		
					
			            $('.dropdown-menu').append('<li data-id="'+  data._id  +'">'+ data.plan[i].goal  +'</li>');
										
					    s.click(function(){
					        console.log(  $(this).attr('data-id'),$(this).attr('data-index') );
						    var index = $(this).attr('data-index');
						    var plan_id = $(this).attr('data-id');
					    })
                    }					
			   }
			   var wid = $('.status-progress').width()/data.plan.length;
			   console.log('wid', $('.status-progress ul').width(), wid);
			   $('.status-progress li').css( "margin-right", wid/3+"px"  );
			   $('.status-progress li a').tooltip(); 			   
           }
    });
}


</script>	

